---
blueprint-uri: sky-lounge/public-skylounge-library/blueprints/gcp/cloud-run/blueprint.yml
workflows:
  - workflow: development
    jobs:
      - job: build
        steps:
          - step: build-container-image
            uri: # Enter the URI to the step definition used to build the container image for your application. Example: sky-lounge/public-skylounge-library/steps/build/pack/java/gradlew/build.yml
      - job: configure-access
        params:
          tf_state_bucket: # The name of the Google Cloud Storage bucket to store terraform state. Example: tfstate.skylounge.dev
          gcp_project: # The Google Cloud project name where the application is deployed. Example: skylounge-dev
          dns_zone_name: # The zone name in Google DNS where to configure the domain mapping. Example: skyloungedev
          cloud_run_domain: # The domain to configure for your application. Example: dashboard.skylounge.dev
          cloud_run_location: # The location where your application is deployed. Example: us-central1
          cloud_run_invoker: # The name of the user allowed to invoke your Cloud Run service. For any authenticated Google user, use `allUsers`. For public access, set to an empty string "". Example: allUsers
    params:
      build_paths: # An array of paths which trigger the build job on change. Example: ["src/**", "build.gradle", "service.yaml"]
  - workflow: production
    jobs:
      - job: configure-access
        params:
          tf_state_bucket: # The name of the Google Cloud Storage bucket to store terraform state. Example: tfstate.skylounge.io
          gcp_project: # The Google Cloud project name where the application is deployed. Example: skylounge-prod
          dns_zone_name: # The zone name in Google DNS where to configure the domain mapping. Example: skyloungeprod
          cloud_run_domain: # The domain to configure for your application. Example: dashboard.skylounge.io
          cloud_run_location: # The location where your application is deployed. Example: us-central1
          cloud_run_invoker: # The name of the user allowed to invoke your Cloud Run service. For any authenticated Google user, use `allUsers`. For public access, set to an empty string "". Example: allUsers

params:
  registry_url: # The artifact registry url where container images are stored. Example: us-central1-docker.pkg.dev/skylounge-common/skylounge-registry
